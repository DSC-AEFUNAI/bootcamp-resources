<main>
  <ng-container *ngIf="auth.user | async as user; else showSignIn">
    <mat-toolbar color="primary" [class.mat-elevation-z2]="true">
      <mat-toolbar-row>
        <span>Bootcamp Resources</span>
        <span class="spacer"></span>

        <mat-chip-list selectable="false" class="hide-in-mobile" aria-label="Account Details">
          <mat-chip disableRipple="true" focusable="false" tabindex="-1" selectable="false">{{ user.displayName }}</mat-chip>
          <mat-chip disableRipple="true" selectable="false">{{ user.email }}</mat-chip>
        </mat-chip-list>

        <button
          mat-ripple
          mat-raised-button
          (click)="auth.signOut()"
          aria-label="Sign Out"
        >
          <span>Sign Out</span>
        </button>
      </mat-toolbar-row>      
      <mat-toolbar-row class="show-in-mobile">
        <mat-chip-list selectable="false" aria-label="Account Details">
          <mat-chip disableRipple="true" focusable="false" tabindex="-1" selectable="false">{{ user.displayName }}</mat-chip>
          <mat-chip disableRipple="true" selectable="false">{{ user.email }}</mat-chip>
        </mat-chip-list>
      </mat-toolbar-row>
    </mat-toolbar>

    <div class="manage">
      <h4>Select Track</h4>
      <mat-form-field appearance="outline">
        <mat-label>Select Track</mat-label>
        <mat-select [(value)]="selectedTrack">
          <mat-option *ngFor="let track of tracks" [value]="track.value">
            {{ track.viewValue }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <div>
        <button mat-button (click)="accordion.openAll()">Expand All</button>
        <button mat-button (click)="accordion.closeAll()">Collapse All</button>
      </div>
      <mat-accordion multi>
        <mat-expansion-panel *ngFor="let form of forms; index as day">
          <mat-expansion-panel-header>
            <mat-panel-title>Day {{ day + 1 }}</mat-panel-title>
          </mat-expansion-panel-header>

          <form [formGroup]="form" (ngSubmit)="onSubmit(form, day)">
            <mat-form-field appearance="outline">
              <mat-label>Title</mat-label>
              <input
                matInput
                required
                minlength="5"
                [formControl]="form.controls.title"
                placeholder="Name of Lesson"
              />
              <mat-error
                *ngIf="
                  form.controls.title.hasError('minlength') &&
                  !form.controls.title.hasError('required')
                "
              >
                At least 5 characters
              </mat-error>
              <mat-error *ngIf="form.controls.title.hasError('required')">
                Title is <strong>required</strong>
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Lesson Link</mat-label>
              <input
                matInput
                required
                minlength="10"
                type="url"
                pattern="^https?:\/\/.+\..+"
                placeholder="https://..."
                [formControl]="form.controls.link"
              />
              <mat-error
                *ngIf="
                  form.controls.link.hasError('pattern') &&
                  !form.controls.link.hasError('required')
                "
              >
                Please enter a valid URL
              </mat-error>
              <mat-error *ngIf="form.controls.link.hasError('required')">
                Lesson Link is <strong>required</strong>
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Detailed Assignment</mat-label>
              <textarea
                matInput
                required
                minlength="20"
                [formControl]="form.controls.assignment"
                placeholder="What should be done?"
                cdkTextareaAutosize
                cdkAutosizeMinRows="3"
              ></textarea>

              <mat-error
                *ngIf="
                  form.controls.assignment.hasError('minlength') &&
                  !form.controls.assignment.hasError('required')
                "
              >
                Please detail the assignment to help the learners
              </mat-error>
              <mat-error *ngIf="form.controls.assignment.hasError('required')">
                Detailed Assignment is <strong>required</strong>
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Correction 1</mat-label>
              <textarea
                matInput
                required
                minlength="20"
                [formControl]="form.controls.correction1"
                placeholder="At least one solution to the assignment"
                cdkTextareaAutosize
                cdkAutosizeMinRows="3"
              ></textarea>
              <mat-error
                *ngIf="
                  form.controls.correction1.hasError('minlength') &&
                  !form.controls.correction1.hasError('required')
                "
              >
                Please detail this correction to help the learners
              </mat-error>
              <mat-error *ngIf="form.controls.correction1.hasError('required')">
                At least one correction is <strong>required</strong>
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Correction 2</mat-label>
              <textarea
                matInput
                minlength="20"
                [formControl]="form.controls.correction2"
                placeholder="Another solution is welcomed"
                cdkTextareaAutosize
                cdkAutosizeMinRows="3"
              ></textarea>
              <mat-error *ngIf="form.controls.correction2.hasError('minlength')">
                Please detail this correction to help the learners
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Correction 3</mat-label>
              <textarea
                matInput
                minlength="20"
                [formControl]="form.controls.correction3"
                placeholder="A third solution will for sure be awesome"
                cdkTextareaAutosize
                cdkAutosizeMinRows="3"
              ></textarea>
              <mat-error *ngIf="form.controls.correction3.hasError('minlength')">
                Please detail this correction to help the learners
              </mat-error>
            </mat-form-field>

            <mat-action-row>
              <button mat-raised-button type="submit" color="primary">
                Update
              </button>
            </mat-action-row>
          </form>
        </mat-expansion-panel>
      </mat-accordion>
    </div>
  </ng-container>

  <ng-template #showSignIn>
    <div class="sign-in">
      <section class="header header__container">
        <img
          class="header header__image"
          src="/assets/images/logo-vertical.png"
          alt="DSC AE-FUNAI logo"
        />
        <img
          class="header header__image"
          src="/assets/images/logo-horizontal.png"
          alt="DSC AE-FUNAI logo"
        />
        <h1 class="header header__title mat-display-1">Bootcamp Resources</h1>
        <p class="header header__message mat-body-1">
          Please sign in so you can assist in managing the resources utilized in
          the DSC AE-FUNAI Bootcamp platform.
        </p>
      </section>
      <firebase-ui></firebase-ui>
    </div>
  </ng-template>
</main>
